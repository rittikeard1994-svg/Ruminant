<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DairyRumi Demo</title>

    <!-- Tailwind (‡πÄ‡∏î‡πÇ‡∏°‡πà) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 (UMD) -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö JSX -->
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>

    <!-- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î Recharts ‡πÅ‡∏ö‡∏ö fallback -->
    <script>
      window.ensureRecharts = function () {
        return new Promise((resolve) => {
          if (window.Recharts) return resolve();

          function add(src, cb) {
            var s = document.createElement("script");
            s.src = src;
            s.onload = cb;
            s.onerror = cb; // ‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà fallback ‡πÅ‡∏°‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏•‡∏≤‡∏î
            document.head.appendChild(s);
          }

          // ‡∏•‡∏≠‡∏á jsDelivr ‡∏Å‡πà‡∏≠‡∏ô
          add("https://cdn.jsdelivr.net/npm/recharts/umd/Recharts.min.js", function () {
            if (window.Recharts) return resolve();

            // Fallback ‚Üí unpkg
            add("https://unpkg.com/recharts/umd/Recharts.min.js", function () {
              resolve(); // resolve ‡∏ï‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ï‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            });
          });
        });
      };
    </script>
  </head>

  <body class="bg-amber-50 text-gray-900">
    <noscript>
      ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏î‡πÇ‡∏°‡∏ô‡∏µ‡πâ
    </noscript>

    <div id="root" class="max-w-5xl mx-auto p-4"></div>

    <!-- ‡πÇ‡∏Ñ‡πâ‡∏î React (‡πÅ‡∏õ‡∏•‡∏á‡∏î‡πâ‡∏ß‡∏¢ Babel) -->
    <script type="text/babel" data-presets="react">
      (async function start() {
        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Recharts ‡πÇ‡∏´‡∏•‡∏î
        await window.ensureRecharts();

        // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á
        if (!window.Recharts) {
          const el = document.getElementById("root");
          el.innerHTML =
            '<div class="max-w-5xl mx-auto p-6 my-6 rounded-2xl bg-white border">' +
            '<h2 class="text-lg font-semibold mb-2">‡πÇ‡∏´‡∏•‡∏î Recharts ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>' +
            '<p class="text-sm text-gray-600">‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï/‡πÑ‡∏ü‡∏£‡πå‡∏ß‡∏≠‡∏•‡∏•‡πå</p>' +
            "</div>";
          return;
        }

        const { useState, useMemo } = React;
        const {
          ResponsiveContainer,
          LineChart,
          Line,
          XAxis,
          YAxis,
          CartesianGrid,
          Tooltip,
          BarChart,
          Bar,
        } = window.Recharts;

        // --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ---
        const mockHerd = [
          { id: 128, name: "‡∏î‡∏≤‡∏ß", dim: 45, baseline: 520, rumiToday: 470, milk: 27 },
          { id: 145, name: "‡∏Ñ‡∏£‡∏µ‡∏°", dim: 12, baseline: 500, rumiToday: 520, milk: 33 },
          { id: 173, name: "‡πÇ‡∏ã‡∏î‡∏≤", dim: 210, baseline: 480, rumiToday: 380, milk: 18 },
        ];

        const mockHistory = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((d, i) => ({
          day: d,
          rumi: [480, 505, 520, 495, 460, 530, 510][i],
          milk: [18, 20, 22, 21, 19, 24, 23][i],
        }));

        function Card({ title, right, children }) {
          return (
            <div className="rounded-3xl bg-white p-5 shadow-sm border">
              <div className="flex items-center justify-between mb-3">
                <div className="font-semibold">{title}</div>
                {right}
              </div>
              {children}
            </div>
          );
        }

        function CowRow({ c }) {
          const dev = Math.round(((c.rumiToday - c.baseline) / c.baseline) * 100);
          const color =
            dev < -15
              ? "bg-red-100 text-red-700"
              : dev < -5
              ? "bg-yellow-100 text-yellow-700"
              : "bg-green-100 text-green-700";

          return (
            <div className="flex items-center justify-between rounded-2xl border p-4 bg-white">
              <div>
                <div className="font-medium">
                  #{c.id} {c.name} ¬∑ DIM {c.dim}
                </div>
                <div className="text-sm text-gray-500">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ {c.rumiToday} ‡∏ô‡∏≤‡∏ó‡∏µ</div>
              </div>
              <span className={`text-xs px-2 py-1 rounded-full ${color}`}>{dev}%</span>
            </div>
          );
        }

        function App() {
          const [tab, setTab] = useState("home");
          const avgRumi = useMemo(
            () => Math.round(mockHerd.reduce((a, b) => a + b.rumiToday, 0) / mockHerd.length),
            []
          );

          return (
            <div className="min-h-screen flex flex-col">
              {/* Top Bar */}
              <header className="sticky top-0 z-20 bg-amber-50/80 backdrop-blur border-b">
                <div className="max-w-5xl mx-auto px-4 py-3 flex items-center gap-4">
                  <div className="rounded-full bg-amber-400/60 w-9 h-9 grid place-items-center">üè†</div>
                  <div className="font-bold">DairyRumi</div>
                  <nav className="ml-auto flex gap-2 text-sm">
                    {["home", "history"].map((t) => (
                      <button
                        key={t}
                        onClick={() => setTab(t)}
                        className={`px-3 py-1.5 rounded-xl ${
                          tab === t ? "bg-black text-white" : "hover:bg-black/5"
                        }`}
                      >
                        {t === "home" ? "‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å" : "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥"}
                      </button>
                    ))}
                  </nav>
                </div>
              </header>

              {/* Content */}
              <main className="flex-1">
                <div className="max-w-5xl mx-auto p-4 grid gap-4">
                  {tab === "home" && (
                    <div className="grid md:grid-cols-3 gap-4">
                      <Card title="‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ù‡∏π‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ">
                        <div className="flex items-center gap-3">
                          <div className="rounded-2xl bg-amber-100 p-3">üêÑ</div>
                          <div>
                            <div className="text-2xl font-bold">
                              ‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏á‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ {avgRumi} ‡∏ô‡∏≤‡∏ó‡∏µ
                            </div>
                            <div className="text-sm text-gray-600">
                              ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö baseline ‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                            </div>
                          </div>
                        </div>
                      </Card>

                      <Card title="‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏ù‡∏π‡∏á ‚Äì ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ">
                        <div className="grid gap-3">
                          {mockHerd.map((c) => (
                            <CowRow key={c.id} c={c} />
                          ))}
                        </div>
                      </Card>

                      <Card title="‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå">
                        <div className="flex items-center gap-3 text-sm">
                          ‚õÖ ‡∏ã‡∏¥‡∏á‡∏Å‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 10:40 ¬∑ ‡πÅ‡∏ö‡∏ï‡∏ï‡πà‡∏≥ 2 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                        </div>
                      </Card>

                      <Card title="‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô">
                        <div className="h-48">
                          <ResponsiveContainer width="100%" height="100%">
                            <LineChart data={mockHistory}>
                              <CartesianGrid strokeDasharray="3 3" />
                              <XAxis dataKey="day" />
                              <YAxis />
                              <Tooltip />
                              <Line type="monotone" dataKey="rumi" strokeWidth={2} />
                            </LineChart>
                          </ResponsiveContainer>
                        </div>
                      </Card>

                      <Card title="‡∏ô‡πâ‡∏≥‡∏ô‡∏° (‡∏•‡∏¥‡∏ï‡∏£/‡∏ß‡∏±‡∏ô)">
                        <div className="h-48">
                          <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={mockHistory}>
                              <CartesianGrid strokeDasharray="3 3" />
                              <XAxis dataKey="day" />
                              <YAxis />
                              <Tooltip />
                              <Bar dataKey="milk" />
                            </BarChart>
                          </ResponsiveContainer>
                        </div>
                      </Card>
                    </div>
                  )}

                  {tab === "history" && (
                    <div className="grid md:grid-cols-2 gap-4">
                      <Card title="‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏á 7 ‡∏ß‡∏±‡∏ô">
                        <div className="h-56">
                          <ResponsiveContainer width="100%" height="100%">
                            <LineChart data={mockHistory}>
                              <CartesianGrid strokeDasharray="3 3" />
                              <XAxis dataKey="day" />
                              <YAxis />
                              <Tooltip />
                              <Line type="monotone" dataKey="rumi" strokeWidth={2} />
                            </LineChart>
                          </ResponsiveContainer>
                        </div>
                      </Card>

                      <Card title="‡∏ô‡πâ‡∏≥‡∏ô‡∏° 7 ‡∏ß‡∏±‡∏ô">
                        <div className="h-56">
                          <ResponsiveContainer width="100%" height="100%">
                            <BarChart data={mockHistory}>
                              <CartesianGrid strokeDasharray="3 3" />
                              <XAxis dataKey="day" />
                              <YAxis />
                              <Tooltip />
                              <Bar dataKey="milk" />
                            </BarChart>
                          </ResponsiveContainer>
                        </div>
                      </Card>
                    </div>
                  )}
                </div>
              </main>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
      })();
    </script>
  </body>
</html>
