<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DairyRumi Demo</title>

    <!-- Tailwind (‡πÄ‡∏î‡πÇ‡∏°‡πà) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 (UMD) -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- helper: ‡πÇ‡∏´‡∏•‡∏î react-is ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ Recharts (‡∏°‡∏µ fallback ‡∏´‡∏•‡∏≤‡∏¢ CDN) -->
    <script>
      // ‡πÇ‡∏´‡∏•‡∏î <script> ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢ CDN ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      async function loadFromCDNs(pathList) {
        for (const src of pathList) {
          const ok = await new Promise((resolve) => {
            const s = document.createElement("script");
            s.src = src + (src.includes("?") ? "&" : "?") + "_=" + Date.now(); // cache-buster
            s.onload = () => resolve(true);
            s.onerror = () => resolve(false);
            document.head.appendChild(s);
          });
          if (ok) return true;
        }
        return false;
      }

      // ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ react-is ‡πÅ‡∏•‡∏∞ Recharts ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î (‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö)
      window.ensureRecharts = async function ensureRecharts() {
        // 1) react-is (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Recharts UMD)
        if (!window.ReactIs) {
          const okReactIs = await loadFromCDNs([
            "https://cdn.jsdelivr.net/npm/react-is/umd/react-is.production.min.js",
            "https://fastly.jsdelivr.net/npm/react-is/umd/react-is.production.min.js",
            "https://gcore.jsdelivr.net/npm/react-is/umd/react-is.production.min.js",
            "https://unpkg.com/react-is/umd/react-is.production.min.js",
          ]);
          if (!okReactIs) return false;
        }

        // 2) Recharts
        if (!window.Recharts) {
          const okRecharts = await loadFromCDNs([
            "https://cdn.jsdelivr.net/npm/recharts/umd/Recharts.min.js",
            "https://fastly.jsdelivr.net/npm/recharts/umd/Recharts.min.js",
            "https://gcore.jsdelivr.net/npm/recharts/umd/Recharts.min.js",
            "https://unpkg.com/recharts/umd/Recharts.min.js",
          ]);
          if (!okRecharts) return false;
        }

        return !!window.Recharts;
      };
    </script>
  </head>

  <body class="bg-amber-50 text-gray-900">
    <div id="root" class="max-w-5xl mx-auto p-4"></div>

    <script>
      (async function start() {
        const e = React.createElement;

        const ready = await window.ensureRecharts();
        const rootEl = document.getElementById("root");

        if (!ready) {
          rootEl.innerHTML =
            '<div class="max-w-5xl mx-auto p-6 my-6 rounded-2xl bg-white border">' +
            '<h2 class="text-lg font-semibold mb-2">‡πÇ‡∏´‡∏•‡∏î Recharts ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>' +
            '<p class="text-sm text-gray-600">‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä (Ctrl+F5) ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏¥‡∏î Ad-block/VPN/Proxy ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</p>' +
            "</div>";
          return;
        }

        const {
          ResponsiveContainer, LineChart, Line, XAxis, YAxis,
          CartesianGrid, Tooltip, BarChart, Bar
        } = window.Recharts;

        // --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ---
        const mockHerd = [
          { id: 128, name: "‡∏î‡∏≤‡∏ß", dim: 45, baseline: 520, rumiToday: 470, milk: 27 },
          { id: 145, name: "‡∏Ñ‡∏£‡∏µ‡∏°", dim: 12, baseline: 500, rumiToday: 520, milk: 33 },
          { id: 173, name: "‡πÇ‡∏ã‡∏î‡∏≤", dim: 210, baseline: 480, rumiToday: 380, milk: 18 },
        ];

        const mockHistory = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map((d, i) => ({
          day: d,
          rumi: [480, 505, 520, 495, 460, 530, 510][i],
          milk: [18, 20, 22, 21, 19, 24, 23][i],
        }));

        // Utilities (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ JSX)
        function Card(props) {
          return e(
            "div",
            { className: "rounded-3xl bg-white p-5 shadow-sm border" },
            e(
              "div",
              { className: "flex items-center justify-between mb-3" },
              e("div", { className: "font-semibold" }, props.title || ""),
              props.right || null
            ),
            props.children
          );
        }

        function CowRow({ c }) {
          const dev = Math.round(((c.rumiToday - c.baseline) / c.baseline) * 100);
          const color =
            dev < -15 ? "bg-red-100 text-red-700" :
            dev <  -5 ? "bg-yellow-100 text-yellow-700" :
                        "bg-green-100 text-green-700";

          return e(
            "div",
            { className: "flex items-center justify-between rounded-2xl border p-4 bg-white" },
            e(
              "div",
              null,
              e("div", { className: "font-medium" }, `#${c.id} ${c.name} ¬∑ DIM ${c.dim}`),
              e("div", { className: "text-sm text-gray-500" }, `‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ${c.rumiToday} ‡∏ô‡∏≤‡∏ó‡∏µ`)
            ),
            e("span", { className: `text-xs px-2 py-1 rounded-full ${color}` }, `${dev}%`)
          );
        }

        function App() {
          const [tab, setTab] = React.useState("home");
          const avgRumi = React.useMemo(() =>
            Math.round(mockHerd.reduce((a, b) => a + b.rumiToday, 0) / mockHerd.length),
          []);

          return e(
            "div",
            { className: "min-h-screen flex flex-col" },

            // Top bar
            e(
              "header",
              { className: "sticky top-0 z-20 bg-amber-50/80 backdrop-blur border-b" },
              e(
                "div",
                { className: "max-w-5xl mx-auto px-4 py-3 flex items-center gap-4" },
                e("div", { className: "rounded-full bg-amber-400/60 w-9 h-9 grid place-items-center" }, "üè†"),
                e("div", { className: "font-bold" }, "DairyRumi"),
                e(
                  "nav",
                  { className: "ml-auto flex gap-2 text-sm" },
                  ["home", "history"].map((t) =>
                    e(
                      "button",
                      {
                        key: t,
                        onClick: () => setTab(t),
                        className:
                          "px-3 py-1.5 rounded-xl " +
                          (tab === t ? "bg-black text-white" : "hover:bg-black/5"),
                      },
                      t === "home" ? "‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å" : "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥"
                    )
                  )
                )
              )
            ),

            // Content
            e(
              "main",
              { className: "flex-1" },
              e(
                "div",
                { className: "max-w-5xl mx-auto p-4 grid gap-4" },

                tab === "home" &&
                  e(
                    "div",
                    { className: "grid md:grid-cols-3 gap-4" },

                    e(
                      Card,
                      { title: "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ù‡∏π‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ" },
                      e(
                        "div",
                        { className: "flex items-center gap-3" },
                        e("div", { className: "rounded-2xl bg-amber-100 p-3" }, "üêÑ"),
                        e(
                          "div",
                          null,
                          e("div", { className: "text-2xl font-bold" }, `‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏á‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${avgRumi} ‡∏ô‡∏≤‡∏ó‡∏µ`),
                          e("div", { className: "text-sm text-gray-600" }, "‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö baseline ‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•")
                        )
                      )
                    ),

                    e(
                      Card,
                      { title: "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏ù‡∏π‡∏á ‚Äì ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ" },
                      e(
                        "div",
                        { className: "grid gap-3" },
                        mockHerd.map((c) => e(CowRow, { key: c.id, c }))
                      )
                    ),

                    e(
                      Card,
                      { title: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" },
                      e(
                        "div",
                        { className: "flex items-center gap-3 text-sm" },
                        "‚õÖ ‡∏ã‡∏¥‡∏á‡∏Å‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î 10:40 ¬∑ ‡πÅ‡∏ö‡∏ï‡∏ï‡πà‡∏≥ 2 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á"
                      )
                    ),

                    e(
                      Card,
                      { title: "‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô" },
                      e(
                        "div",
                        { className: "h-48" },
                        e(
                          ResponsiveContainer,
                          { width: "100%", height: "100%" },
                          e(
                            LineChart,
                            { data: mockHistory },
                            e(CartesianGrid, { strokeDasharray: "3 3" }),
                            e(XAxis, { dataKey: "day" }),
                            e(YAxis, null),
                            e(Tooltip, null),
                            e(Line, { type: "monotone", dataKey: "rumi", strokeWidth: 2 })
                          )
                        )
                      )
                    ),

                    e(
                      Card,
                      { title: "‡∏ô‡πâ‡∏≥‡∏ô‡∏° (‡∏•‡∏¥‡∏ï‡∏£/‡∏ß‡∏±‡∏ô)" },
                      e(
                        "div",
                        { className: "h-48" },
                        e(
                          ResponsiveContainer,
                          { width: "100%", height: "100%" },
                          e(
                            BarChart,
                            { data: mockHistory },
                            e(CartesianGrid, { strokeDasharray: "3 3" }),
                            e(XAxis, { dataKey: "day" }),
                            e(YAxis, null),
                            e(Tooltip, null),
                            e(Bar, { dataKey: "milk" })
                          )
                        )
                      )
                    )
                  ),

                tab === "history" &&
                  e(
                    "div",
                    { className: "grid md:grid-cols-2 gap-4" },

                    e(
                      Card,
                      { title: "‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß‡πÄ‡∏≠‡∏∑‡πâ‡∏≠‡∏á 7 ‡∏ß‡∏±‡∏ô" },
                      e(
                        "div",
                        { className: "h-56" },
                        e(
                          ResponsiveContainer,
                          { width: "100%", height: "100%" },
                          e(
                            LineChart,
                            { data: mockHistory },
                            e(CartesianGrid, { strokeDasharray: "3 3" }),
                            e(XAxis, { dataKey: "day" }),
                            e(YAxis, null),
                            e(Tooltip, null),
                            e(Line, { type: "monotone", dataKey: "rumi", strokeWidth: 2 })
                          )
                        )
                      )
                    ),

                    e(
                      Card,
                      { title: "‡∏ô‡πâ‡∏≥‡∏ô‡∏° 7 ‡∏ß‡∏±‡∏ô" },
                      e(
                        "div",
                        { className: "h-56" },
                        e(
                          ResponsiveContainer,
                          { width: "100%", height: "100%" },
                          e(
                            BarChart,
                            { data: mockHistory },
                            e(CartesianGrid, { strokeDasharray: "3 3" }),
                            e(XAxis, { dataKey: "day" }),
                            e(YAxis, null),
                            e(Tooltip, null),
                            e(Bar, { dataKey: "milk" })
                          )
                        )
                      )
                    )
                  )
              )
            )
          );
        }

        const root = ReactDOM.createRoot(rootEl);
        root.render(e(App));
      })();
    </script>
  </body>
</html>
